<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor ML - {{ dataset_info.nombre_dataset|default('Dataset') }}</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .seccion { border: 1px solid #ddd; padding: 20px; margin: 10px 0; border-radius: 5px; }
        .grafica { width: 100%; height: 400px; margin: 20px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input, select { padding: 5px; margin: 5px; }
        .resultado { background: #f8f9fa; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîÆ Predictor de {{ target_col }}</h1>
    
    <!-- Secci√≥n 1: Informaci√≥n del dataset -->
    <div class="seccion">
        <h2>üìä Dataset: {{ dataset_info.nombre|default('car_price_clean.csv') }}</h2>
        <p>Filas: {{ dataset_info.filas }}, Columnas: {{ dataset_info.columnas }}</p>
        <div id="info-dataset"></div>
    </div>
    
    <!-- Secci√≥n 2: Configuraci√≥n de muestra -->
    <div class="seccion">
        <h2>‚öôÔ∏è Configurar Muestra</h2>
        <label>Semilla aleatoria: <input type="number" id="semilla" value="42"></label>
        <label>Porcentaje a usar: 
            <select id="porcentaje">
                <option value="1.0">100%</option>
                <option value="0.95">95%</option>
                <option value="0.9">90%</option>
                <option value="0.8">80%</option>
                <option value="0.7">70%</option>
                <option value="0.6">60%</option>
                <option value="0.5">50%</option>
                <option value="0.4">40%</option>
                <option value="0.3">30%</option>
                <option value="0.2">20%</option>
                <option value="0.1">10%</option>
                <option value="0.05">5%</option>
            </select>
        </label>
        <label>Divisi√≥n entrenamiento/prueba: 
            <select id="split">
                <option value="0.8">80/20</option>
                <option value="0.7">70/30</option>
            </select>
        </label>
        <button onclick="configurar()">Aplicar Configuraci√≥n</button>
        <div id="mensaje-config" class="resultado"></div>
    </div>
    
    <!-- Secci√≥n 3: Evaluaci√≥n y gr√°ficas -->
    <div class="seccion">
        <h2>üìà Evaluar Modelo</h2>
        <button onclick="evaluar()">Generar Gr√°ficas y M√©tricas</button>
        <div id="metricas" class="resultado"></div>
        <div id="grafica-matriz" class="grafica"></div>
        <div id="grafica-dist" class="grafica"></div>
        <div id="grafica-imp" class="grafica"></div>
    </div>
    
    <!-- Secci√≥n 4: Predicci√≥n Manual -->
    <div class="seccion">
        <h2>üîç Realizar Predicci√≥n Manual</h2>
        
        <form id="form-prediccion">
            <!-- Campos num√©ricos -->
            <div>
                <label>A√±o (Year): <input type="number" id="Year" value="2020" min="2000" max="2023"></label>
            </div>
            
            <div>
                <label>Tama√±o Motor (Engine Size): <input type="number" id="Engine_Size" value="2.0" step="0.1" min="1.0" max="5.0"></label>
            </div>
            
            <div>
                <label>Kilometraje (Mileage): <input type="number" id="Mileage" value="50000" min="0" max="200000"></label>
            </div>
            
            <!-- Brand -->
            <div>
                <label>Marca (Brand): 
                    <select id="Brand">
                        <option value="Toyota">Toyota</option>
                        <option value="Honda">Honda</option>
                        <option value="Ford">Ford</option>
                        <option value="BMW">BMW</option>
                        <option value="Mercedes">Mercedes</option>
                        <option value="Tesla">Tesla</option>
                    </select>
                </label>
            </div>
            
            <!-- Fuel Type -->
            <div>
                <label>Tipo Combustible (Fuel Type): 
                    <select id="Fuel_Type">
                        <option value="Petrol">Petrol</option>
                        <option value="Diesel">Diesel</option>
                        <option value="Electric">Electric</option>
                        <option value="Hybrid">Hybrid</option>
                    </select>
                </label>
            </div>
            
            <!-- Transmission -->
            <div>
                <label>Transmisi√≥n (Transmission): 
                    <select id="Transmission">
                        <option value="Automatic">Automatic</option>
                        <option value="Manual">Manual</option>
                    </select>
                </label>
            </div>
            
            <button type="button" onclick="realizarPrediccion()">üîÆ Predecir Condici√≥n</button>
        </form>
        
        <div id="resultado-prediccion" class="resultado"></div>
    </div>

    <script>
    async function realizarPrediccion() {
        try {
            // Recoger datos del formulario
            const datos = {
                "Year": parseFloat(document.getElementById('Year').value),
                "Engine Size": parseFloat(document.getElementById('Engine_Size').value),
                "Mileage": parseFloat(document.getElementById('Mileage').value),
                "Brand": document.getElementById('Brand').value,
                "Fuel Type": document.getElementById('Fuel_Type').value,
                "Transmission": document.getElementById('Transmission').value
            };
            
            const response = await fetch('/predecir_manual', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(datos)
            });
            
            const resultado = await response.json();
            const divResultado = document.getElementById('resultado-prediccion');
            
            if (resultado.success) {
                divResultado.innerHTML = `
                    <h3>‚úÖ Resultado de la Predicci√≥n</h3>
                    <p><strong>Condici√≥n predicha:</strong> ${resultado.prediccion}</p>
                    <p><strong>Confianza:</strong> ${(resultado.confianza * 100).toFixed(1)}%</p>
                    <p><strong>Probabilidades:</strong></p>
                    <ul>
                        <li>Nuevo (New): ${(resultado.probabilidades.New * 100).toFixed(1)}%</li>
                        <li>Como Nuevo (Like New): ${(resultado.probabilidades['Like New'] * 100).toFixed(1)}%</li>
                        <li>Usado (Used): ${(resultado.probabilidades.Used * 100).toFixed(1)}%</li>
                    </ul>
                `;
            } else {
                divResultado.innerHTML = `<p style="color: red;">‚ùå ${resultado.error}</p>`;
            }
        } catch (error) {
            document.getElementById('resultado-prediccion').innerHTML = 
                `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
        }
    }
    </script>
    
    <script src="/static/js/app.js"></script>
</body>
</html>